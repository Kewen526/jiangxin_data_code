# å¿«é€Ÿå¼€å§‹æŒ‡å—

## âš¡ 5 åˆ†é’Ÿå¿«é€Ÿéƒ¨ç½²

### æ­¥éª¤ 1: å®‰è£…ä¾èµ–

```bash
cd /home/user/jiangxin_data_code
pip3 install -r requirements.txt
```

### æ­¥éª¤ 2: é…ç½®æ•°æ®åº“

ç¼–è¾‘ `report_generator.py` ç¬¬ 17-26 è¡Œï¼Œç¡®è®¤æ•°æ®åº“é…ç½®ï¼š

```python
DB_CONFIG = {
    'host': '8.146.210.145',
    'port': 3306,
    'user': 'root',
    'password': 'Kewen888@',
    'database': 'jx_data',  # âš ï¸ è¯·ç¡®è®¤æ•°æ®åº“åç§°ï¼
    ...
}
```

**é‡è¦**: è¯·ç¡®è®¤æ•°æ®åº“åç§°æ˜¯å¦ä¸º `jx_data`ï¼Œå¦‚æœä¸æ˜¯è¯·ä¿®æ”¹ï¼

### æ­¥éª¤ 3: æµ‹è¯•è¿æ¥

```bash
python3 << 'EOF'
import mysql.connector

conn = mysql.connector.connect(
    host='8.146.210.145',
    port=3306,
    user='root',
    password='Kewen888@'
)
cursor = conn.cursor()
cursor.execute("SHOW DATABASES")
print("å¯ç”¨çš„æ•°æ®åº“:")
for db in cursor.fetchall():
    print(f"  - {db[0]}")
cursor.close()
conn.close()
EOF
```

å¦‚æœçœ‹åˆ°æ•°æ®åº“åˆ—è¡¨ï¼Œè¯´æ˜è¿æ¥æˆåŠŸï¼

### æ­¥éª¤ 4: ç”Ÿæˆç¬¬ä¸€ä»½æŠ¥è¡¨

#### æ–¹å¼ A: ç›´æ¥è¿è¡Œï¼ˆç”Ÿæˆç¤ºä¾‹æŠ¥è¡¨ï¼‰

```bash
python3 report_generator.py
```

è¿™å°†ç”Ÿæˆæ‰€æœ‰å››ç§æŠ¥è¡¨çš„ç¤ºä¾‹ã€‚

#### æ–¹å¼ B: Python ä»£ç è°ƒç”¨

```python
from report_generator import generate_daily_report

# ç”Ÿæˆæ—¥æŠ¥
generate_daily_report('2025-12-12')
```

#### æ–¹å¼ C: å¯åŠ¨ API æœåŠ¡

```bash
python3 api_server.py
```

ç„¶åé€šè¿‡ HTTP è¯·æ±‚è°ƒç”¨ï¼š

```bash
curl -X POST http://localhost:5000/api/reports/daily \
  -H "Content-Type: application/json" \
  -d '{"report_date": "2025-12-12"}' \
  --output æ—¥æŠ¥.xlsx
```

---

## ğŸ“ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: æ‰‹åŠ¨ç”ŸæˆæŠ¥è¡¨ï¼ˆä¸€æ¬¡æ€§ï¼‰

é€‚åˆä¸´æ—¶éœ€æ±‚ï¼Œç›´æ¥è¿è¡Œ Python è„šæœ¬ï¼š

```python
from report_generator import generate_weekly_report

generate_weekly_report(
    week1_start='2025-11-10',
    week1_end='2025-11-16',
    week2_start='2025-11-17',
    week2_end='2025-11-23'
)
```

### åœºæ™¯ 2: å®šæ—¶ä»»åŠ¡ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰

ä½¿ç”¨ Cron æˆ–ç³»ç»Ÿå®šæ—¶ä»»åŠ¡ï¼š

```bash
# crontab -e
# æ¯å¤©å‡Œæ™¨ 1 ç‚¹ç”Ÿæˆæ˜¨æ—¥æ—¥æŠ¥
0 1 * * * cd /home/user/jiangxin_data_code && python3 -c "from report_generator import generate_daily_report; from datetime import datetime, timedelta; generate_daily_report((datetime.now() - timedelta(days=1)).strftime('%Y-%m-%d'))"
```

### åœºæ™¯ 3: Web ç³»ç»Ÿé›†æˆ

å¯åŠ¨ API æœåŠ¡ï¼Œå‰ç«¯é€šè¿‡ HTTP è¯·æ±‚è°ƒç”¨ï¼š

```bash
# å¯åŠ¨æœåŠ¡
python3 api_server.py

# æˆ–ä½¿ç”¨ Gunicornï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
gunicorn -w 4 -b 0.0.0.0:5000 api_server:app
```

å‰ç«¯è°ƒç”¨ç¤ºä¾‹ï¼ˆJavaScriptï¼‰ï¼š

```javascript
fetch('http://localhost:5000/api/reports/daily', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({report_date: '2025-12-12'})
})
.then(response => response.blob())
.then(blob => {
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'æ—¥æŠ¥_2025-12-12.xlsx';
    a.click();
});
```

---

## ğŸ” éªŒè¯æŠ¥è¡¨æ˜¯å¦æ­£ç¡®

### 1. æ£€æŸ¥æ–‡ä»¶å¤§å°

ç”Ÿæˆçš„ Excel æ–‡ä»¶ä¸åº”è¯¥ä¸ºç©ºï¼ˆä¸€èˆ¬ > 10KBï¼‰

```bash
ls -lh *.xlsx
```

### 2. æ£€æŸ¥è¡Œæ•°

- æ—¥æŠ¥ï¼šè¡Œæ•° = é—¨åº—æ•°é‡ + 1ï¼ˆè¡¨å¤´ï¼‰
- å‘¨æŠ¥ï¼šè¡Œæ•° = é—¨åº—æ•°é‡ Ã— 8
- æœˆæŠ¥ï¼šè¡Œæ•° = é—¨åº—æ•°é‡ Ã— 8
- è‡ªå®šä¹‰ï¼šè¡Œæ•° = é—¨åº—æ•°é‡ Ã— 4

### 3. æ£€æŸ¥æ•°æ®

ç”¨ Excel æˆ– WPS æ‰“å¼€æ–‡ä»¶ï¼Œæ£€æŸ¥ï¼š
- âœ… æ•°æ®æ˜¯å¦å®Œæ•´
- âœ… è®¡ç®—å­—æ®µï¼ˆè½¬åŒ–ç‡ã€å®¢å•ä»·ï¼‰æ˜¯å¦æ­£ç¡®
- âœ… å·®å€¼æ˜¯å¦æ­£ç¡®
- âœ… æ ·å¼æ˜¯å¦æ­£å¸¸ï¼ˆè¾¹æ¡†ã€å¯¹é½ã€é¢œè‰²ï¼‰

---

## â“ å¸¸è§é—®é¢˜

### Q1: æ•°æ®åº“è¿æ¥è¶…æ—¶

**åŸå› **: é˜²ç«å¢™ã€ç½‘ç»œé—®é¢˜æˆ–æ•°æ®åº“æœªå¼€å¯è¿œç¨‹è¿æ¥

**è§£å†³**:
1. æ£€æŸ¥æ•°æ®åº“æœåŠ¡å™¨é˜²ç«å¢™æ˜¯å¦å¼€æ”¾ 3306 ç«¯å£
2. ç¡®è®¤ MySQL é…ç½®å…è®¸è¿œç¨‹è¿æ¥ï¼ˆ`bind-address = 0.0.0.0`ï¼‰
3. æ£€æŸ¥ç½‘ç»œè¿æ¥

### Q2: ç”Ÿæˆçš„æŠ¥è¡¨æ²¡æœ‰æ•°æ®

**åŸå› **: æ•°æ®åº“ä¸­è¯¥æ—¶é—´æ®µæ²¡æœ‰æ•°æ®

**è§£å†³**:
1. å…ˆæŸ¥è¯¢æ•°æ®åº“ç¡®è®¤æ•°æ®å­˜åœ¨ï¼š
   ```sql
   SELECT COUNT(*) FROM kewen_daily_report WHERE report_date = '2025-12-12';
   ```
2. æ£€æŸ¥æ•°æ®åº“åç§°æ˜¯å¦æ­£ç¡®
3. æ£€æŸ¥è¡¨åæ˜¯å¦æ­£ç¡®

### Q3: æŠ¥è¡¨ä¸­è¿è¥ã€é”€å”®å­—æ®µä¸ºç©º

**åŸå› **: ä»£ç ä¸­æœªå®ç° `platform_accounts` è¡¨çš„å…³è”

**è§£å†³**: éœ€è¦æ ¹æ®å®é™…çš„ `platform_accounts.stores_json` å­—æ®µç»“æ„è¿›è¡Œè§£æ

### Q4: å¯¼å…¥æ¨¡å—å¤±è´¥

**é”™è¯¯**: `ModuleNotFoundError: No module named 'mysql'`

**è§£å†³**:
```bash
pip3 install mysql-connector-python openpyxl flask flask-cors
```

---

## ğŸ“Š æ•°æ®å¯¹ç…§

### å‘¨æŠ¥ vs åŸå§‹æ—¥æŠ¥æ•°æ®

å‘¨æŠ¥ä¸­çš„æ•°æ®æ˜¯é€šè¿‡èšåˆå¤šå¤©æ•°æ®è®¡ç®—å¾—å‡ºï¼š

| å­—æ®µç±»å‹ | èšåˆæ–¹å¼ | ç¤ºä¾‹ |
|---------|---------|------|
| ç´¯åŠ å­—æ®µ | SUM | æ›å…‰äººæ•° = å‘¨ä¸€ + å‘¨äºŒ + ... + å‘¨æ—¥ |
| æ¯”ç‡å­—æ®µ | é‡æ–°è®¡ç®— | æ›å…‰è®¿é—®è½¬åŒ–ç‡ = SUM(è®¿é—®äººæ•°) / SUM(æ›å…‰äººæ•°) |
| å¹³å‡å­—æ®µ | é‡æ–°è®¡ç®— | å®¢å•ä»· = SUM(ä¼˜æƒ åæ ¸é”€é¢) / SUM(æ ¸é”€äººæ•°) |

### å·®å€¼è®¡ç®—è§„åˆ™

- æ•°å€¼å­—æ®µï¼šç¬¬äºŒæœŸ - ç¬¬ä¸€æœŸ
- ç™¾åˆ†æ¯”å­—æ®µï¼šç›´æ¥ç›¸å‡ï¼ˆå¦‚ 15% - 14% = 1%ï¼‰

ç¤ºä¾‹ï¼š
- ç¬¬ä¸€å‘¨æ›å…‰äººæ•°ï¼š5831
- ç¬¬äºŒå‘¨æ›å…‰äººæ•°ï¼š5712
- å·®å€¼ï¼š5712 - 5831 = -119

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### 1. è¿æ¥æ± é…ç½®

ä»£ç ä¸­å·²é…ç½®è¿æ¥æ± ï¼Œæœ€å¤§è¿æ¥æ•° 20ï¼š

```python
CONNECTION_POOL = mysql.connector.pooling.MySQLConnectionPool(
    pool_name="jx_pool",
    pool_size=20,  # å¯æ ¹æ®å®é™…å¹¶å‘é‡è°ƒæ•´
    pool_reset_session=True,
    **DB_CONFIG
)
```

### 2. å¹¶å‘å¤„ç†

- å•ä¸ªæŠ¥è¡¨ç”Ÿæˆï¼šçº¦ 2-5 ç§’
- è¿æ¥æ± å¯æ”¯æŒæœ€å¤š 20 ä¸ªå¹¶å‘è¯·æ±‚
- å»ºè®®ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ Gunicorn å¤šè¿›ç¨‹éƒ¨ç½²

### 3. ç¼“å­˜ç­–ç•¥ï¼ˆå¯é€‰ï¼‰

å¯¹äºç›¸åŒå‚æ•°çš„è¯·æ±‚ï¼Œå¯ä»¥ç¼“å­˜ç”Ÿæˆçš„æŠ¥è¡¨æ–‡ä»¶ï¼Œå‡å°‘æ•°æ®åº“æŸ¥è¯¢ï¼š

```python
import hashlib
import os

def get_cache_filename(params):
    cache_key = hashlib.md5(str(params).encode()).hexdigest()
    return f"./cache/{cache_key}.xlsx"

# åœ¨ç”ŸæˆæŠ¥è¡¨å‰æ£€æŸ¥ç¼“å­˜
cache_file = get_cache_filename(params)
if os.path.exists(cache_file):
    return cache_file  # ç›´æ¥è¿”å›ç¼“å­˜æ–‡ä»¶
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

é‡åˆ°é—®é¢˜ï¼Ÿè¯·æ£€æŸ¥ï¼š

1. âœ… æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸
2. âœ… ä¾èµ–åŒ…æ˜¯å¦æ­£ç¡®å®‰è£…
3. âœ… Python ç‰ˆæœ¬æ˜¯å¦ >= 3.7
4. âœ… æ•°æ®åº“è¡¨ç»“æ„æ˜¯å¦ä¸ä»£ç åŒ¹é…

æ›´å¤šè¯¦ç»†è¯´æ˜è¯·å‚è€ƒï¼š
- `README_ä½¿ç”¨è¯´æ˜.md` - è¯¦ç»†çš„åŠŸèƒ½è¯´æ˜
- `API_è°ƒç”¨ç¤ºä¾‹.md` - API è°ƒç”¨ç¤ºä¾‹

---

## ğŸ‰ å¼€å§‹ä½¿ç”¨

```bash
# å…‹éš†æˆ–ä¸‹è½½ä»£ç 
cd /home/user/jiangxin_data_code

# å®‰è£…ä¾èµ–
pip3 install -r requirements.txt

# ç”Ÿæˆç¬¬ä¸€ä»½æŠ¥è¡¨
python3 -c "from report_generator import generate_daily_report; generate_daily_report('2025-12-12')"

# æˆ–å¯åŠ¨ API æœåŠ¡
python3 api_server.py
```

ç¥ä½¿ç”¨æ„‰å¿«ï¼ ğŸš€
